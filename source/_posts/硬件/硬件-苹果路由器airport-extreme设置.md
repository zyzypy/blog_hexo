---
title: 苹果路由器airport-extreme(a1354)设置 | macbookpro连不上网
comments: true
toc: false
date: 2018-04-19 13:25:19
updated: 2018-07-20 16:17:19
tags:
- mac
- apple
- 苹果
- 路由器
categories:
- 硬件
banner: airportexpress_1x_byWinson.png
---
这是一篇写给垃圾佬和图钉的文章。
## 起因
macbookpro 2013late，第一次连上WIFI，然后再也连不上，各种调整后偶尔可以连上，一两个小时不动睡眠后再连连不上。  
其它设备macmini iphone就行。一度让我以为是macbook的系统问题或网络设置缓存问题或网卡水土不服问题，百度发现了很多人这样  
phone的热点连接却一下就上很快很稳定🤔。
## 症状
连不上时会dhcp分配一个167.224.69.24(记不清了)开头的ip，这个ip是"没有ip"的默认ip，类似localhost的127.0.0.1，相当于给一个默认值，方便程序逻辑，IEEE协会制定。
刚开始以为mac网卡没自动识别出来，然后花了很多时间手动设置ip。  
手动设置ip网关后右上角WIFI图标是已连接，但后来发现是ping不通网关的😠，这个坑浪费了时间。

## 断网时的排查
尝试了一些解决方法，花了两天时间气死我了😤，macbook哪都好就是上不了网急不急人😂：  
-  清除网络配置文件  
    Command + Shift + G, 输入:
    ```bash
    /Library/Preferences/SystemConfiguration
    ```
    删除：
    ```bash
    com.apple.airport.preferences.plist
    com.apple.network.identification.plist
    NetworkInterfaces.plist
    preferences.plist
    ```
    回收站清不清空都行，一个答案说情况，一个答案给的applecare客服截图说不用清，据我观察都行  
    重启  
- 添加新的位置  
    设置》网络 位置。如果没有设置过的话，显示的是"自动"，点击新增一个位置比如"myhome"，然后再添加WIFI连接。这个方法其实也是防止缓存。
- 拔掉usb扩展
    usb hub会被认为连接了有线网络，也可能因为设计问题，usb和WIFI无法同时工作
- 清除arp缓存  
    ```bash
    sudo arp -a -d
    ```
- 信道2.4Ghz影响  
    查看周围信道情况的软件[istumbler](https://istumbler.net/)
    或终端 
    ```bash
    sudo ln -s /System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airport /usr/local/bin/airport
    airport -s
    ```
    选一个人少的信道  
    
    有网友说改到6或9，实际发现跟6或9关系不大，如果成功是因为碰巧你周围的WIFI没有占用这两个频道  
    2.4Ghz信道1-11，其中有一些信道频率是重复的，设备多容易互相影响。比如我的桌上有无线键鼠、switch、蓝牙机械键盘、家里两个路由、能搜到楼上楼下10余WIFI  
    事后发现这个原因是导致不能上网的主要原因之一
- 路由器老旧
    家里有三个路由器，各自不同的表现让我混淆
    - 思科nv10-wf
    *这几张找的网图*
    ![](思科nav-10.png)
    网上淘的二手，企业路由，用料奢华，运行稳定，2WAN+8LAN全千兆。缺点设置复杂，无线为54mpbs。最重要的是macbook连不上提示密码错误（密码输入正确）。  
    - 腾达W311R 
    ![](腾达w311r.jpg)
    一款极为普通的家用路由，上个路由坏的时候联通营业厅买的，很轻，偶尔丢包需要重启，卧室用。这才发现它已经用了很多年了，54mpbs。连上过两次后来连不上。调整信道、带宽等各种设置还是不能连上macbook。  
    - 大R杂货改装的路由
    ![](大R杂货1.png)
    ![](大R杂货2.png)
    好像是从一款入门tplink改装的，这家店很有特色[大R杂货铺](https://rickey.taobao.com/index.htm?spm=2013.1.w5002-8397256775.2.3d533e81raG79j)，
    店主把路由器pcb板子拿出来换上亚克力壳子，颜值很高，还可以定制内存大小，别致和极客。
    缺点毕竟亚克力，实物没有图片那么好看，灯一闪一闪的影响晚上睡觉。潘多拉系统，设置也不简单，一直吃灰。300mbps 2.4Ghz。拿出来一下就连上了，才知道是路由器导致上不了网，之前一直以为ip什么的配置错了😂
    同样是2.4Ghz，在卧室信号都很强，只是一款路由新点就能连上，老款有问题的老路由不知道为什么连不上。
- DNS
    不知道是路由还是macbook的问题，链接路由后dns空白或自动是上一级网关192.168.1.1（卧室路由192.168.0.1连客厅路由192.168.1.1），需要改成正常的dns地址
    如谷歌的8.8.8.8或阿里的223.5.5.5。 有网友情况相反，需要填入192.168.1.1才能上网，估计路由中做了dns。  
- 开机重置
    **cmd+opt+P+R**,清除系统参数记忆体(重置PRAM)(类似于清空缓存)，可以改善电源、风扇、键盘灯等问题
- 清除钥匙串
    密码输入正确却显示无效，spotlight（聚焦搜索）中打开"钥匙串.app", 搜索SSID，删除。  
    
## macbook连不上的原因
macbook对wifi比较挑剔，需要新路由  
macOS的网络缓存机制不合理，这么容易出问题不明白为什么没有对应措施，每次出问题都要把上面的一些步骤折腾一下， 程序员都快受不了了，普通用户怎么用
    

## 选择新路由
我的情况经过试验，主要由于路由器问题。考虑到iphone的手机热点稳定，想着自家产品支持应该比较好。
看网友有人说用的苹果路由，又想到之前看过一篇文章《苹果失败的电子产品有哪些》中看到过苹果路由😅，所以淘宝搜索
"苹果路由"又叫**"Airport"**，直译"飞机场"，看来苹果路由的寓意是想像飞机场✈️一样中转数据    
国内苹果商店未上架，另外官方发声明要停产了，有点忐忑。要不要买个小米\tplink\斐讯之类的主流的，不敢，万一还连不上怎么办。。
### 型号对比
主要有三种档次：
- AIRPORT EXPRESS ：特快，音乐基站，1WAN，体型小直接插插座上价格最便宜
- AIRPORT EXTREME  ： 特别特别快，无线路由， 1WAN+4LAN，体型中等跟普通路由长得差不多  
    几个型号外形一致，1354和1408价格差50%。网上也找到说参数区别的，询问一店主后得到答案：
    - A1301型号，覆盖90平方米左右，双频600M
    - A1354型号，覆盖100平方米左右，双频750M
    - A1408型号，覆盖110平方米左右，双频900M
    看上去没什么差别，同一档次的型号换代而已，好像分别是第三、四、五代
- AIRPORT TIME CAPSULE  ： 时间返回舱， 带1T至3T硬盘，算是nas，体型大价格贵
于是选择了A1354（好像算是四代，1408是五代）

## Airport extreme A1354
二手，两百多，看上去很新，近看划痕较多。塑料材质，底部整层的橡胶防滑垫。毕竟，它用镁铝外壳的话销量会更惨淡。。
![](实拍_DSC1066.jpg)
![](实拍_DSC1067.jpg)
![](实拍_DSC1068.jpg)

连上电源、WAN后开始设置：
1. 打开airport  
launchpad启动器中找到或 快捷键**cmd+空格**，spotlight聚焦搜索"airport"
![](airport1.png)
2. mac设备会自动发现路由器
WIFI直连技术，不用插一根网线到LAN口了。第一台连接的设备可以设置路由器无线名和密码，用针点reset按钮应该会重置。
![](airport2.png)
![](airport3.png)
3. 设定无线网络
SSID（无线网名字） 密码这些的。SSID支持中文。根据设备用户名已自动填写，基站名称指设备名称，我把它跟SSID起成一样的了。
![](airport4.png)
4. 完成
![](airport5.png)
![](airport6.png)
5. 高级设置
- DNS：我这里dns自动获取为上级路由的网关地址，导致无法连接互联网，所以手动修改dns为8.8.8.8或233.5.5.5
![](airport6.png)
- 5Ghz时SSID： 无线选项卡》无线设置。起了个不同的名字以区分。WIFI搜索中可以看到两个名字，为了macbook始终连接5Ghz。  
默认的是一个SSID，路由**自动判断**，终端离得近时会以5Ghz连接以求速度快，离得远时会以2.4Ghz模式连接以求信号📶强。
- 文件共享： usb接hfs格式的移动硬盘相当于time capsule。inder中的网络可以看到
6. 共享
airport extreme摇身一变CAPSULE时间胶囊😁。  
移动硬盘插到路由器usb口上（图略，我使用的是13年买的750g的移动硬盘，平时用来做备份）。  
注意移动硬盘的格式为"**Apple日志式**"，可在airport设置-磁盘中看到已经识别， windows的"NTFS"可不行，否则无反应。
设置允许共享和连接验证方式如下，"设备密码"的意思是无线密码，"用户名密码"的意思是设置一个专门访问它的账户。
![](共享0.png)
更新重启airport后生效。  
打开访达finder-共享的，我这里的名字是Airportextrem，连接密码其实是无线密码，比较方便。有需要的话可以设置账户名密码的形式。最终效果
![](共享1.png)
调整下时间备份的磁盘
![](共享2.png)
发现必须要用户名和密码，所以回到了上面的设置修改验证方式为"用户名密码的方式"。
[](共享3.png)
奇怪地遇到一些bug。如果验证方式为"用户名密码"，finder中能连接磁盘但看不到内容。如果"设备密码"方式，时间机器中看不到磁盘。我最后调整为"磁盘密码"，但连接时没有输入密码就连接了，可能因为钥匙串自动连得，
仍然提示需要用户名密码，结果用之前设置的"用户名密码"成功了，但是由于账户名变了需要重新第一次备份。如果设置了现在正在使用的用户名，那么无法找到磁盘。最终，我放弃了timemachine。

## 优点
airport软件设置简单清楚  
工业设计可以，苹果一致的外观  
没有丑丑的天线  
挺沉的，里面用料应该是跟企业路由一个档次的  
几年前的产品750的速率够在特色网速下坚持好几年了🙄
## 缺点
修改任何设置会重启，重启时间较长半分钟到一分钟时间，比如只是改下dns。修改电脑上的dns就比较方便了。电脑上的dns优先级高于路由器上的，如果电脑没有设置的话采用路由器上的。  
比起iphone和mac没那么惊艳，外形没有那么出众，除了无天线，大小和电源适配器跟普通路由并无不同感觉有些累赘，体积较大
不支持中继  

## license
文章中的设备在我购买时已经过时，当你看到这篇文章时，请灵活选择新一点的型号。
原创文章，欢迎转载。